import{u as S,r as o,j as e,L as E}from"./index-DWpanXyB.js";import{a as A,S as C}from"./syncService-S-CTgAlo.js";import{A as k}from"./alert-circle-2wasBPe3.js";function P(){const{dispatch:c}=S(),[s,b]=o.useState(""),[r,y]=o.useState(""),[h,x]=o.useState(!1),[p,m]=o.useState(null),[j,i]=o.useState(""),N=async n=>{var g;if(n.preventDefault(),!s.trim()||!r.trim()){m("Please enter username and password");return}x(!0),m(null),i("Connecting...");try{const t=A();if(!t)throw new Error("Failed to initialize Supabase");const u=`${s.trim()}@lightapp.io`;i("Signing in...");let{data:l,error:d}=await t.auth.signInWithPassword({email:u,password:r.trim()});if(d&&d.message.includes("Invalid login credentials")){i("Creating account...");const{data:a,error:f}=await t.auth.signUp({email:u,password:r.trim(),options:{data:{username:s.trim(),display_name:"Stefan"}}});if(f)throw f;if(a.user&&!a.user.email_confirmed_at&&((g=a.user.identities)==null?void 0:g.length)===0)throw new Error("Email confirmation required. Check your email or disable email confirmation in Supabase Dashboard > Authentication > Providers > Email.");if(l=a,!l.session){const{data:v,error:w}=await t.auth.signInWithPassword({email:u,password:r.trim()});if(w)throw w;l=v}}else if(d)throw d;c({type:"SET_AUTH",payload:{isAuthenticated:!0,userId:l.user.id,email:l.user.email,username:s.trim()}}),i("Syncing data...");try{await C.pullAll(),c({type:"HYDRATE"})}catch(a){console.warn("Initial sync failed:",a.message)}}catch(t){m(t.message||"Login failed")}finally{x(!1),i("")}};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 relative",style:{background:"#0f172a"},children:[e.jsx("div",{className:"floating-orb",style:{width:300,height:300,background:"radial-gradient(circle, rgba(99,102,241,0.15), transparent 70%)",top:"5%",left:"-10%"}}),e.jsx("div",{className:"floating-orb",style:{width:250,height:250,background:"radial-gradient(circle, rgba(139,92,246,0.12), transparent 70%)",bottom:"10%",right:"-5%",animationDelay:"2s"}}),e.jsx("div",{className:"w-20 h-20 rounded-3xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center mb-6 shadow-2xl",children:e.jsx("span",{className:"text-3xl font-heading font-bold text-white",children:"L"})}),e.jsx("h1",{className:"text-3xl font-heading font-bold text-white mb-1",children:"Light"}),e.jsx("p",{className:"text-sm text-white/50 mb-8",children:"Your personal life dashboard"}),e.jsxs("div",{className:"glass-card w-full max-w-sm p-6",children:[p&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-xl bg-red-500/10 border border-red-500/20 mb-4",children:[e.jsx(k,{size:16,className:"text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-red-400",children:p})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/40 mb-1.5 block",children:"Username"}),e.jsx("input",{type:"text",value:s,onChange:n=>b(n.target.value),placeholder:"tefata",className:"glass-input",autoFocus:!0,autoComplete:"username"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/40 mb-1.5 block",children:"Password"}),e.jsx("input",{type:"password",value:r,onChange:n=>y(n.target.value),placeholder:"Enter password",className:"glass-input",autoComplete:"current-password"})]}),e.jsx("button",{type:"submit",disabled:h,className:"w-full py-3.5 rounded-xl font-heading font-semibold text-white flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50",style:{background:"linear-gradient(135deg, #6366f1, #8b5cf6)",boxShadow:"0 4px 20px rgba(99,102,241,0.3)"},children:h?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:18,className:"animate-spin"})," ",j||"Signing in..."]}):"Sign In"})]}),e.jsx("p",{className:"text-[10px] text-white/20 text-center mt-4",children:"New accounts are created automatically on first login"})]}),e.jsx("button",{onClick:()=>c({type:"SET_AUTH",payload:{isAuthenticated:!0,userId:null,email:null,username:"guest"}}),className:"mt-6 text-xs text-white/30 hover:text-white/50 transition-colors",children:"Continue without login"}),e.jsx("p",{className:"text-[10px] text-white/20 mt-8",children:"Light v3.0.0"})]})}export{P as default};
